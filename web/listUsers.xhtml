<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                template="/WEB-INF/template/template.xhtml"
                xmlns:a="http://xmlns.jcp.org/jsf/passthrough"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
                xmlns:f="http://xmlns.jcp.org/jsf/core">

    <ui:define name="content">

        <div class="row">
            <div class="container-fluid">
                <h1 class="centered">Encuentra comida de vendedores particulares</h1>
            </div>
        </div>
        <div class="row">
            <div class="col s12">
                <div class="card-panel teal">
                    <span class="white-text">Encuentra comida de vendedores particulares
                    </span>
                </div>
            </div>
        </div>
        <div class="container-fluid">
            <h:form id="listUsers"> 


                <h:dataTable   var="User" value="#{userCtrl.users}" class="table table-bordered centered" border="2"  >
                    <h:column>
                        <f:facet name="header">
                            <h:outputText value="Nombre"></h:outputText>
                        </f:facet>
                        <h:outputText value="#{User.name}" ></h:outputText>
                    </h:column>
                    <h:column>
                        <f:facet name="header">
                            <h:outputText value="Email "></h:outputText>
                        </f:facet>
                        <h:outputText value="#{User.email}" ></h:outputText>
                    </h:column>
                    <h:column>
                        <f:facet name="header">
                            <h:outputText value="Dirección "></h:outputText>
                        </f:facet>
                        <h:outputText value="#{User.address}" ></h:outputText>
                    </h:column>
                    <h:column>
                        <f:facet name="header">
                            <h:outputText value="Movil "></h:outputText>
                        </f:facet>
                        <h:outputText value="#{User.phone}" ></h:outputText>
                    </h:column>
                    <h:column>
                        <f:facet name="header">
                            <h:outputText value="Rating "></h:outputText>
                        </f:facet>
                        <p:rating value="5" class="estrellas"></p:rating>
                    </h:column>
                    <h:column>
                        <f:facet name="header">
                            <h:outputText value="Contactar"></h:outputText>
                        </f:facet>
                        <a data-target="writeMessage" class="btn-floating blue-grey darken-1"><i class="material-icons">format_quote</i></a>

                    </h:column>
                    <h:column>
                        <f:facet name="header">
                            <h:outputText value="Ver en el mapa"></h:outputText>
                        </f:facet>
                        <a class="btn-floating blue-grey darken-1"><i class="material-icons">location_on</i></a>
                    </h:column>

                </h:dataTable> 
            </h:form>
        </div>
        <!-- Modal Structure Shopping Cart-->
        <div id="writeMessage" class="modal modal-fixed-footer">
            <div class="modal-content">
                <center>
                    <h4>Escribe el mensaje  </h4>
                </center>
                <h:form>


                </h:form>
            </div>
        </div>
        <h:form prependId="false">  
            <h:panelGrid columns="3"  cellpadding="5">
                <p:outputLabel for="address" value="Dirección:" />
                <p:inputText id="address" />
                <p:commandButton value="Buscar en las cercanias" icon="ui-icon-search" onclick="geocode()" type="button" />
            </h:panelGrid>
            <!--<div class="iframe-rwd">-->
            <h:form>
                <p:gmap id="gmap" center="37.1773363,-3.5985570999999936" zoom="13" type="ROADMAP" model="#{mapCtrl.advancedModel}" style="width:100%;height:800px">

                    <p:ajax event="overlaySelect" listener="#{mapCtrl.onMarkerSelect}" />

                    <p:gmapInfoWindow id="infoWindow">




                        <p:outputPanel style="text-align: center;">

                            <h:graphicImage library="images" name="defecto.png" />
                            <div class="row">

                            </div>          

                            <div class="row">

                                <h:outputText style="font-size: larger" value="#{mapCtrl.marker.shadow}" />

                            </div>

                            <div class="row">
                                <p:rating value="5" class="estrellas" styleClass="center-rating"></p:rating>
                            </div>

                            <div class="btn" onclick="Materialize.toast('Escribe el mensaje para ese usuario', 4000, '', function () {

                                    })">Contactar</div>
                            <p:commandButton class="btn" value="Ver que ofrece" action="#{userCtrl.enabletable}" update="panel" >
                            </p:commandButton>

                        </p:outputPanel>



                    </p:gmapInfoWindow>
                </p:gmap>
            </h:form>
            <!--</div>-->






            <p:outputPanel id="panel" >


                <p:dataTable class="table-bordered" reflow="true" value="#{productCtrl.getProductsUser(userCtrl.getUserByName(mapCtrl.marker.title).id)}" var="p" rendered="#{userCtrl.showtable}" >

                    <input type="hidden" value="#{userCtrl.getUserByName(request.getUserPrincipal()).id}" id="id_user" name="id_user"></input>
                    <input type="hidden" value="#{orderCtrl.order}" id="order" name="order"></input>
                    <ul class="collection">
                        <p:column>

                            <div class="card-image waves-effect waves-block waves-light">
                                <img class="activator" src="resources/images/croquetas.jpg" width="100%" height="100%"></img>
                            </div>
                        </p:column>
                        <p:column headerText="Producto">
                            <h:outputText value="#{p.name}">
                            </h:outputText>
                        </p:column>

                        <p:column headerText="Precio">
                            <h:outputText value="#{p.precio}"></h:outputText>
                        </p:column>

                        <p:column headerText="Valoración">
                            <p:rating value="#{p.ratingAverage}" class="estrellas" styleClass="center-rating"></p:rating>
                        </p:column>
                        

                        <p:column>

                            <h:form>
                                <h:commandButton id="anadir"  class="btn btn-skin btn-scroll"  value="Añadir al carrito" action="#{orderCtrl.createOrder(23.44)}"/>
                            </h:form>

                        </p:column>

                    </ul>

                </p:dataTable>

            </p:outputPanel>
        </h:form>
        <h:form>
            <input type="hidden" value="#{userCtrl.getUserByName(request.getUserPrincipal()).id}" id="id_user" name="id_user"></input>
            <div class="row">
                <div class="input-field col s12">

                    <h:inputText id="name"   value="#{orderCtrl.order.total}"/>
                    <label for="name">total del pedido</label>
                </div>
            </div>
            <div class="row">
                <div class="input-field col s12">

                    <h:inputText id="precio"   value="#{orderCtrl.order.state}"/>
                    <label for="precio">estado</label>
                </div>
            </div>


            <p:column>


                <h:commandButton id="anadir"  class="btn btn-skin btn-scroll"  value="crear pedido" action="#{orderCtrl.createOrder(23.44)}"/>


            </p:column>

        </h:form>



    </ui:define>



</ui:composition>